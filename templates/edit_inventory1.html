{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="manifest" href="{% static 'pwa/manifest.json' %}">
<meta name="theme-color" content="#002550">
<link rel="apple-touch-icon" href="{% static 'pwa/icons/icon-192.png' %}">
  <title>Edit Inventory</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    :root{ --brand:#002550; --bg1:#a1c4fd; --bg2:#c2e9fb; --card:#ffffff; --shadow:0 2px 4px rgba(0,0,0,.1); --navbar-h:60px; --mheader-h:56px; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(120deg,var(--bg1) 0%,var(--bg2) 100%); background-attachment:fixed; min-height:100vh; color:#1b1f24; display:flex; flex-direction:column; }
    .navbar{ display:flex; justify-content:space-between; align-items:center; background:#fff; padding:10px 20px; box-shadow:var(--shadow); height:var(--navbar-h); z-index:100; }
    @media (min-width:769px){ .navbar{ position:fixed; top:0; left:0; right:0; } body{ padding-top:var(--navbar-h); } }
    .logo{height:40px}
    .nav-links{display:flex; gap:24px; align-items:center}
    .nav-links a, .nav-links form button{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px; text-decoration:none; color:var(--brand); font-size:12px; font-weight:600; background:none; border:none; cursor:pointer; padding:4px 6px; }
    .content{ flex:1; overflow:auto; padding:20px 16px 24px; display:flex; align-items:flex-start; justify-content:center; }
    .card{ width:100%; max-width:980px; background:var(--card); border-radius:12px; box-shadow:var(--shadow); padding:22px; }
    h2{ margin:6px 0 16px; text-align:center; color:rgba(2,37,70,.92); }
    .form-grid{ display:grid; gap:16px; grid-template-columns: 1fr 1fr; } @media (max-width:768px){ .form-grid{ grid-template-columns:1fr; } }
    .form-group{ display:flex; flex-direction:column; }
    .form-group label{ font-size:13px; font-weight:700; color:var(--brand); letter-spacing:.2px; margin-bottom:6px; }
    .form-group input{ padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; background:#fff; font-size:14px; outline:none; }
    .form-group input:focus{ border-color:#94a3b8; box-shadow:0 0 0 3px #dbeafe; }
    #total_value[readonly]{ background:#f8fafc; color:#334155; }
    .actions{ display:flex; gap:12px; justify-content:center; margin-top:18px; flex-wrap:wrap; }
    .btn{ border:none; cursor:pointer; padding:10px 18px; font-size:14px; font-weight:700; border-radius:10px; box-shadow:var(--shadow); }
    .btn-primary{ background:linear-gradient(90deg,#04035c,#0073e6); color:#fff; }
    .btn-ghost{ background:#e5efff; color:#0f172a; }
    .error{ background:#fee2e2; color:#991b1b; border:1px solid #fecaca; padding:10px 12px; border-radius:8px; margin-bottom:14px; }
    .muted{ color:#475569; font-size:12px; }
  </style>
</head>
<body>
  <div class="navbar" role="navigation" aria-label="Primary">
    <img src="{% static 'Images/logo.png' %}" alt="Logo" class="logo"/>
    <div class="nav-links">
      <a href="{% url 'admin' %}" title="Home"><i class="fas fa-home" aria-hidden="true"></i><span>Home</span></a>
      {% if user.is_authenticated %}
      <form action="{% url 'logout' %}" method="POST" style="margin:0" aria-label="Logout">
        {% csrf_token %}
        <button type="submit" title="Logout"><i class="fas fa-sign-out-alt" aria-hidden="true"></i><span>Logout</span></button>
      </form>
      {% endif %}
    </div>
  </div>

  <div class="content">
    <div class="card">
      <h2>Edit Inventory Item</h2>

      {% if form_error %}
        <div class="error">{{ form_error }}</div>
      {% endif %}

      <form method="POST">
        {% csrf_token %}

        <div class="form-grid">
          <div class="form-group">
            <label for="material_code">Material Code</label>
            <input type="text" id="material_code" name="material_code" value="{{ inventory.material_code }}" required>
          </div>

          <div class="form-group">
            <label for="material_desc">Material Description</label>
            <input type="text" id="material_desc" name="material_desc" value="{{ inventory.material_desc }}" required>
          </div>

          <div class="form-group">
            <label for="uom">UOM</label>
            <input type="text" id="uom" name="uom" value="{{ inventory.uom }}" required>
          </div>

          <div class="form-group">
            <label for="owner">Owner</label>
            <input type="text" id="owner" name="owner" value="{{ inventory.owner }}" required>
          </div>

          <div class="form-group">
            <label for="type">Type</label>
            <input type="text" id="type" name="type" value="{{ inventory.type }}" required>
          </div>

          <div class="form-group">
            <label for="category">Category</label>
            <input type="text" id="category" name="category" value="{{ inventory.category }}" required>
          </div>


          <!-- <div class="form-group">
  <label for="opening_stock">Available Stock</label>
  <input
    type="number"
    id="opening_stock"
    name="opening_stock"
    value="{{ inventory.opening_stock }}"
    readonly
    aria-readonly="true"
  >
  <div class="muted">Opening Stock: {{ inventory.fixed_stock|default:"—" }}</div>
</div> -->


          <!-- <div class="form-group">
            <label for="opening_stock">Opening Stock (Available)</label>
            <input type="number" id="opening_stock" name="opening_stock" value="{{ inventory.opening_stock }}" required min="0" step="1"
                   {% if max_addable is not None and max_addable == 0 %}max="{{ inventory.opening_stock }}"{% endif %}>
            <div class="muted">Fixed Stock: {{ inventory.fixed_stock|default:"—" }}</div>
          </div> -->

          <div class="form-group">
            <label for="unit_value">Unit Value</label>
            <input type="number" id="unit_value" name="unit_value" value="{{ inventory.unit_value }}" required min="0" step="0.01">
          </div>


          <div class="form-group">
            <label for="adding_stock">Add Stock</label>
            <input type="number" id="adding_stock" name="adding_stock" min="0" step="1"
                   value="{{ adding_stock_value }}"
                   {% if max_addable is not None %}max="{{ max_addable }}"{% endif %}>
            {% if max_addable is not None %}
              <div class="muted">Max you can add now: <b>{{ max_addable }}</b> (to keep ≤ Fixed Stock)</div>
            {% endif %}
          </div>

          <div class="form-group" style="grid-column:1 / -1;">
            <label for="total_value">Total Value</label>
            <input type="text" id="total_value" name="total_value" value="₹{{ total_value|floatformat:2 }}" readonly>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">Save Changes</button>
          <a href="{% url 'site_analysis' %}?site_name={{ site_name }}" class="btn btn-ghost as-button">Cancel</a>
        </div>
      </form>
    </div>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js');
  });
}
  </script>
</body>
</html>
