{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    :root{
      --brand:#0b5fe0; 
      --brand-dark:#001e6a;
      --text:#0f172a; 
      --muted:#475569;
      --card:#ffffff; 
      --shadow:0 12px 30px rgba(2,6,23,.18);
      --radius:16px; 
      --header-h:72px;
      /* ✅ Added background gradient colors */
      --bg-grad-1:#a1c4fd;
      --bg-grad-2:#c2e9fb;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
      color:var(--text); 
      min-height:100svh; 
      display:flex; 
      flex-direction:column;
      background:linear-gradient(120deg,var(--bg-grad-1) 0%, var(--bg-grad-2) 100%) fixed;
      -webkit-font-smoothing:antialiased; 
      text-rendering:optimizeLegibility;
    }

    :focus-visible{
      outline:3px solid color-mix(in oklab, var(--brand), white 40%);
      outline-offset:2px; 
      border-radius:12px
    }

    /* Navbar */
    .navbar{
      position:sticky; top:0; z-index:10;
      height:var(--header-h);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 max(16px, env(safe-area-inset-left)) 0 max(16px, env(safe-area-inset-right));
      background:rgba(255,255,255,.9);
      backdrop-filter:saturate(180%) blur(8px);
      border-bottom:1px solid rgba(0,0,0,.06);
    }
    .navbar .logo{ height:40px; width:auto }

    .nav-tiles{ display:flex; align-items:center; gap:6px }
    .nav-tile{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:4px; width:clamp(52px, 12vw, 66px); height:clamp(48px, 10vw, 58px); border-radius:12px;
      text-decoration:none; color:var(--brand-dark); background:transparent; border:none; cursor:pointer;
      -webkit-tap-highlight-color:transparent; touch-action:manipulation;
    }
    .nav-tile:hover{ background:rgba(255,255,255,.6) }
    .nav-tile i{ font-size:20px; line-height:1 }
    .nav-tile .label{ font-size:.75rem; font-weight:800; line-height:1 }

    main{ flex:1; padding:clamp(12px,3.5vw,28px) 12px }
    .container{ width:min(100%,1024px); margin:0 auto }

    :root{ --ops:#0b5fe0; --ops-2:#7ab0ff; --rep:#7c3aed; --rep-2:#b39afc; --border:rgba(0,0,0,.08) }
    @media (prefers-color-scheme: dark){ :root{ --border:rgba(255,255,255,.14) } }

    .navbox{
      position:relative;
      width:min(100%, 980px);
      margin: clamp(40px, 12vh, 120px) auto 28px;
      background:linear-gradient(180deg, rgba(255,255,255,.97), rgba(255,255,255,.9));
      border:1px solid var(--border);
      border-radius:16px; box-shadow:var(--shadow); backdrop-filter:blur(6px);
      padding:10px;
    }

    .navgrid{ display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:14px; align-items:start }
    @media (max-width:720px){ .navgrid{ grid-template-columns:1fr } }

    .link-list{ list-style:none; margin:0; padding:0 }
    .link-list li{ border-top:1px dashed color-mix(in oklab, var(--accent) 25%, rgba(0,0,0,.06)) }
    .link-list li:first-child{ border-top:none }
    .link-list a{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:14px 12px; text-decoration:none;
      color:var(--text); font-weight:700; line-height:1.2; border-radius:10px; position:relative; overflow:hidden;
      -webkit-tap-highlight-color:transparent;
    }
    .link-list a:hover, .link-list a:focus-visible{ background:color-mix(in oklab, var(--accent) 12%, white) }
    .link-list a:active{ transform:translateY(.5px) }
    .link-list a.is-last{ outline:2px solid color-mix(in oklab, var(--accent) 55%, white); outline-offset:2px }
    .link-list a::after{ content:'›'; font-size:20px; line-height:1 }

    .navbox .acc{ border:1px solid var(--border); border-radius:12px; overflow:hidden; background:rgba(255,255,255,.6) }
    .navbox .acc.ops{ --accent:var(--ops); --accent2:var(--ops-2) }
    .navbox .acc.reports{ --accent:var(--rep); --accent2:var(--rep-2) }

    .navbox .acc summary{
      cursor:pointer; list-style:none; outline:none; user-select:none;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 12px; font-weight:800; letter-spacing:.01em; color:var(--text);
      background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
      position:relative
    }
    .navbox .acc summary::-webkit-details-marker{ display:none }
    .navbox .acc summary::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:6px; border-radius:12px 0 0 12px;
      background:linear-gradient(180deg, var(--accent), var(--accent2)); background-size:100% 200%;
      animation:barflow 6s ease-in-out infinite;
    }
    @keyframes barflow{ 0%{ background-position:0 0 } 50%{ background-position:0 100% } 100%{ background-position:0 0 } }

    .navbox .acc summary::after{ content:'›'; font-size:20px; line-height:1; transition:transform .15s ease }
    .navbox .acc[open] summary::after{ transform:rotate(90deg) }
    .navbox .acc[open] summary{ box-shadow: inset 0 -2px 0 color-mix(in oklab, var(--accent) 70%, white) }

    .navbox .acc .link-list{ padding:0 6px 8px }
    .navbox .acc[open] .link-list{ animation:accreveal .15s ease }
    @keyframes accreveal{ from{ opacity:0; transform:translateY(-2px) } to{ opacity:1; transform:none } }

    footer{
      background: rgba(255,255,255,.86);
      border-top: 1px solid rgba(0,0,0,.06);
      text-align: center;
      padding: 14px 16px calc(14px + env(safe-area-inset-bottom, 0px));
      display: flex; align-items: center; justify-content: center;
      font-size: .9rem; color: #0a0a0a; position: relative; z-index: 1;
    }

    @supports not (backdrop-filter: blur(6px)){
      .navbar, .card{ background:#fff }
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <header class="navbar">
    <img src="{% static 'Images/logo.png' %}" alt="Logo" class="logo" />
    <div class="nav-tiles">
      {% if user.is_authenticated %}
      <form action="{% url 'logout' %}?next=/user/login/" method="POST" style="margin:0">
        {% csrf_token %}
        <button type="submit" class="nav-tile" aria-label="Logout">
          <i class="fas fa-sign-out-alt"></i><span class="label">Logout</span>
        </button>
      </form>
      {% endif %}
    </div>
  </header>

  <!-- Main -->
  <main>
    <div class="container">
      <section class="navbox">
        <div class="navgrid">
          <details class="acc ops" open>
            <summary>Operations</summary>
            <ul class="link-list">
              <li><a href="{% url 'complaint_form' %}">Complaints</a></li>
              <li><a href="{% url 'visitor_log_user_view' %}">Gate Pass</a></li>
              <li><a href="{% url 'edit_inventory' site_name=site_name %}">Inventory</a></li>
            </ul>
          </details>
          <details class="acc reports">
            <summary>Reports</summary>
            <ul class="link-list">
              <li><a href="{% url 'button_page' %}">Service Report</a></li>
            </ul>
          </details>
        </div>
      </section>
    </div>
  </main>

  <footer>© {% now "Y" %} SOLON India Private Limited. All rights reserved.</footer>

  <script>
  // Accordion open state + smooth animation
  function slide(acc, opening){
    const content = acc.querySelector('.link-list');
    if(!content) return;
    const start = content.scrollHeight;
    content.style.overflow = 'hidden';
    if(opening){
      content.style.height = '0px';
      requestAnimationFrame(()=>{
        content.style.transition = 'height 160ms ease';
        content.style.height = start + 'px';
      });
    } else {
      content.style.height = start + 'px';
      requestAnimationFrame(()=>{
        content.style.transition = 'height 160ms ease';
        content.style.height = '0px';
      });
    }
    content.addEventListener('transitionend', ()=>{
      content.style.removeProperty('height');
      content.style.removeProperty('overflow');
      content.style.removeProperty('transition');
    }, {once:true});
  }

  (function(){
    const accs = document.querySelectorAll('.navbox .acc');
    accs.forEach((acc)=>{
      const key = 'acc.' + (acc.classList.contains('ops')? 'ops' : 'reports');
      const saved = localStorage.getItem(key);
      if(saved !== null){ acc.open = (saved === 'true'); }
      acc.addEventListener('toggle', ()=>{ localStorage.setItem(key, acc.open); slide(acc, acc.open); });
    });

    const links = document.querySelectorAll('.navbox .link-list a');
    const last = localStorage.getItem('dash.last');
    if(last){
      const found = Array.from(links).find(a => a.getAttribute('href') === last);
      if(found) found.classList.add('is-last');
    }
    links.forEach(a => a.addEventListener('click', ()=>{ localStorage.setItem('dash.last', a.getAttribute('href')); }));
  })();

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js');
    });
  }
  </script>

  <script>window.LOGIN_PATH = '/user/login/';</script>
  <script src="{% static 'js/auth-guard.js' %}"></script>
</body>
</html>
